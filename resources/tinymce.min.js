!function(){tinymce.PluginManager.add("ithoughts_html_snippets",function(t,e){t.addButton("ithoughts_html_snippet",{text:!1,image:ithoughts_html_snippets.base_url+"/resources/icon-tinymce.png",onclick:function(){var e=null
jQuery.post(ithoughts_html_snippets.admin_ajax,{action:"ithoughts_html_snippets_get_list",search:""},function(n){console.log(n),t.windowManager.open({title:t.getLang("ithoughts_html_snippets_tinymce.chose_snippet"),body:[new tinyMCE.ui.Factory.create({type:"form",title:t.getLang("ithoughts_html_snippets_tinymce.list"),items:[{type:"listbox",label:t.getLang("ithoughts_html_snippets_tinymce.snippet"),name:"snippet_id",values:n.data.snippets,value:e,tooltip:t.getLang("ithoughts_html_snippets_tinymce.snippet_explain")}]})],onsubmit:function(n){console.log(n),e=n.data.snippet_id,jQuery.post(ithoughts_html_snippets.admin_ajax,{action:"ithoughts_html_snippets_get_snippet",id:e},function(n){console.log(n)
var i=n.data.content,s=i.match(/%([^\s]+?)%/g)
console.log(s)
for(var a=[],o=0,p=s.length;p>o;o++){var l=i.match(/%([^\s]+?)%/)[1]
l.match(/$if-/)||-1!==["snippet-id","snippet-name","user_login","user_email","user_firstname","user_lastname","user_pseudo"].indexOf(l)||a.push({type:"textbox",name:l,label:l,value:""})}t.windowManager.open({title:t.getLang("ithoughts_html_snippets_tinymce.edit_snippet")+'"'+n.data.title+'"',body:a,onsubmit:function(n){console.log(n.data)
var i=""
for(var s in n.data)i+=s+'="'+n.data[s].replace('"',"&aquot;")+'"'
t.insertContent('[html_snippet snippet-id="'+e+'" '+i+"]")}})})}})})}})})}()
