/**
 * @file resources/tinymce.js Initialize the tinymce plugin
 *
 * @author Gerkin
 * @copyright 2016 iThoughts Informatique
 * @license http://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html GPLv2
 * @package ithoughts\html_snippets
 *
 * @version 1.0.1
 */
!function(){function t(){var t=null
jQuery.post(ithoughts_html_snippets.admin_ajax,{action:"ithoughts_html_snippets_get_list",search:""},function(e){var n=new tinyMCE.ui.Factory.create({type:"form",title:editor.getLang("ithoughts_html_snippets_tinymce.list"),items:[{type:"listbox",label:editor.getLang("ithoughts_html_snippets_tinymce.snippet"),name:"snippet_id",values:e.data.snippets,value:t,tooltip:editor.getLang("ithoughts_html_snippets_tinymce.snippet_explain")}]})
editor.windowManager.open({title:editor.getLang("ithoughts_html_snippets_tinymce.chose_snippet"),body:[n],onsubmit:i})})}function i(t){snippetId=t.data.snippet_id,jQuery.post(ithoughts_html_snippets.admin_ajax,{action:"ithoughts_html_snippets_get_snippet",id:snippetId},function(t){var e=t.data.content,i=e.match(/%([^\s]+?)%/g);(null==i||"undefined"==typeof i)&&(i=[]),console.log(i)
for(var s=[],p=0,a=i.length;a>p;p++){var o=e.match(/%([^\s]+?)%/)[1]
o.match(/$if-/)||-1!==["snippet-id","snippet-name","user_login","user_email","user_firstname","user_lastname","user_pseudo"].indexOf(o)||s.push({type:"textbox",name:o,label:o,value:""})}i.length>0?editor.windowManager.open({title:editor.getLang("ithoughts_html_snippets_tinymce.edit_snippet")+'"'+t.data.title+'"',body:s,onsubmit:function(t){n(snippetId,t.data)}}):n(snippetId,{})})}function n(t,i){console.log(e.data)
var n=""
for(var s in i)n+=s+'="'+e.data[s].replace('"',"&aquot;")+'"'
editor.insertContent('[html_snippet snippet-id="'+t+'" '+n+"]")}tinymce.PluginManager.add("ithoughts_html_snippets",function(e,i){e.addButton("ithoughts_html_snippet",{text:!1,image:ithoughts_html_snippets.base_url+"/resources/icon-tinymce.png",onclick:t})})}()
