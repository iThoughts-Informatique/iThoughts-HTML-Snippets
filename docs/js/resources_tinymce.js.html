<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: resources/tinymce.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: resources/tinymce.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file resources/tinymce.js Initialize the tinymce plugin
 *
 * @author Gerkin
 * @copyright 2016 iThoughts Informatique
 * @license http://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html GPLv2
 * @package ithoughts\html_snippets
 *
 * @version 1.0.1
 */

/**
 * @namespace tinymce-plugin
 */
/**
 * @function __autoexec
 * @memberof tinymce-plugin
 * @desc Add the plugin button to TinyMCE and declare {@link tinymce-plugin} functions in scope.
 * @private
 * @author Gerkin
 */
(function(){
	
	/**
	 * @function initSelectSnippet
	 * @memberof tinymce-plugin
	 * @desc Retrieves a list of HTML Snippets available via ajax and display a TinyMCE dropdown to select one of them
	 * @private
	 * @author Gerkin
	 */
	function initSelectSnippet(){
		var snippetId = null;
		jQuery.post(ithoughts_html_snippets.admin_ajax, {
			action: "ithoughts_html_snippets_get_list",
			search: ""
		}, function(data){
			// Open window
			var tinyMceBody = new tinyMCE.ui.Factory.create({
				type:"form",
				title: editor.getLang('ithoughts_html_snippets_tinymce.list'),
				items:[
					{
						type:"listbox",
						label:editor.getLang('ithoughts_html_snippets_tinymce.snippet'),
						name:"snippet_id",
						values:data.data.snippets,
						value: snippetId,
						tooltip:editor.getLang('ithoughts_html_snippets_tinymce.snippet_explain')
					}
				]
			});
			editor.windowManager.open({
				title: editor.getLang('ithoughts_html_snippets_tinymce.chose_snippet'),
				body: [ tinyMceBody ],
				onsubmit: initPlaceholdersInput
			});
		})
	}

	/**
	 * @function initPlaceholdersInput
	 * @memberof tinymce-plugin
	 * @desc Get the selected snippet content and check if placeholders are found. If there are, display inputs to set them
	 * @param {Object} tinyMceSubmitEvent event emitted by the "Submit" action triggered from {@link tinymce-plugin.initSelectSnippet}
	 * @private
	 * @author Gerkin
	 */
	function initPlaceholdersInput(tinyMceSubmitEvent){
		snippetId = tinyMceSubmitEvent.data.snippet_id;
		jQuery.post(ithoughts_html_snippets.admin_ajax, {
			action: "ithoughts_html_snippets_get_snippet",
			id: snippetId
		}, function(data){
			// Open window
			var content = data.data.content;
			var matches = content.match(/%([^\s]+?)%/g);
			if(matches == null || typeof matches == "undefined")
				matches = [];
			console.log(matches);
			var form = [];
			for(var i = 0, j = matches.length; i &lt; j; i++){
				var name = content.match(/%([^\s]+?)%/)[1];
				if(!name.match(/$if-/) &amp;&amp; [
					"snippet-id",
					"snippet-name",
					"user_login",
					"user_email",
					"user_firstname",
					"user_lastname",
					"user_pseudo"
				].indexOf(name) === -1){
					form.push({
						type   : 'textbox',
						name   : name,
						label  : name,
						value  : ''
					});
				}
			}
			if(matches.length > 0){
				editor.windowManager.open({
					title: editor.getLang('ithoughts_html_snippets_tinymce.edit_snippet') + '"' + data.data.title + '"',
					body: form,
					onsubmit: function(e){
						finish(snippetId, e.data);
					}
				});
			} else {
				finish(snippetId,{});
			}
		});
	}
	
	/**
	 * @function finish
	 * @memberof tinymce-plugin
	 * @desc Compose &amp; insert the shortcode
	 * @param {Number} snippetId Id of the snippet
	 * @param {Object} data Key-values data of placeholders
	 * @private
	 * @author Gerkin
	 */
	function finish(snippetId, data){
		console.log(e.data);
		// Insert content when the window form is submitted
		var str = "";
		for(var i in data){
			str += i + "=\"" + e.data[i].replace('"', '&amp;aquot;') + '"'; 
		}
		editor.insertContent('[html_snippet snippet-id="' + snippetId + '" ' + str + "]");
	}

	tinymce.PluginManager.add('ithoughts_html_snippets', function(editor, url) {
		// Add a button that opens a window
		editor.addButton('ithoughts_html_snippet', {
			text: false,
			image: ithoughts_html_snippets.base_url + "/resources/icon-tinymce.png",
			onclick: initSelectSnippet
		});
	});
})();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Externals</h3><ul><li><a href="external-_jQuery_.html">jQuery</a></li></ul><h3>Classes</h3><ul><li><a href="$.ui.iviewer.ImageObject.html">ImageObject</a></li><li><a href="external-_jQuery_.fn.html">fn</a></li></ul><h3>Namespaces</h3><ul><li><a href="tinymce-plugin.html">tinymce-plugin</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$">$</a></li><li><a href="global.html#$d">$d</a></li><li><a href="global.html#$w">$w</a></li><li><a href="global.html#_getMouseCoords">_getMouseCoords</a></li><li><a href="global.html#_handleMouseMove">_handleMouseMove</a></li><li><a href="global.html#_mouseDrag">_mouseDrag</a></li><li><a href="global.html#_mouseStart">_mouseStart</a></li><li><a href="global.html#_mouseStop">_mouseStop</a></li><li><a href="global.html#_reset">_reset</a></li><li><a href="global.html#angle">angle</a></li><li><a href="global.html#center">center</a></li><li><a href="global.html#containerToImage">containerToImage</a></li><li><a href="global.html#createui">createui</a></li><li><a href="global.html#d">d</a></li><li><a href="global.html#display_width">display_width</a></li><li><a href="global.html#find_closest_zoom_rate">find_closest_zoom_rate</a></li><li><a href="global.html#fit">fit</a></li><li><a href="global.html#gei">gei</a></li><li><a href="global.html#getContainerOffset">getContainerOffset</a></li><li><a href="global.html#imageToContainer">imageToContainer</a></li><li><a href="global.html#info">info</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#loaded">loaded</a></li><li><a href="global.html#moveTo">moveTo</a></li><li><a href="global.html#object">object</a></li><li><a href="global.html#qs">qs</a></li><li><a href="global.html#qsa">qsa</a></li><li><a href="global.html#set_zoom">set_zoom</a></li><li><a href="global.html#setCoords">setCoords</a></li><li><a href="global.html#setImageProps">setImageProps</a></li><li><a href="global.html#toOriginalCoords">toOriginalCoords</a></li><li><a href="global.html#toRealCoords">toRealCoords</a></li><li><a href="global.html#x">x</a></li><li><a href="global.html#y">y</a></li><li><a href="global.html#zoom_by">zoom_by</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Mar 07 2016 22:22:22 GMT-1000 (TAHT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
